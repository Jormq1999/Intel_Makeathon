# AI-Friendly Feedback for `05-code-generation-templates.md`

**Source Repository:** `/nfs/site/disks/juanpsal_disk_002/iscp-fst/ip-csme`

## 1. Analysis Summary

The `ip-csme` repository makes extensive use of a template-based code generation system. This is an excellent pattern for an AI agent to hook into. Instead of generating entire files from scratch, the agent can generate the specific logic required to populate these templates. This ensures consistency and reduces the amount of boilerplate code the agent needs to produce.

## 2. Key Templates and Their Purpose

The `verif/csme_usbr/env/templates/` and `verif/csme_usbr/tests/templates/` directories contain the most relevant templates for the agent.

### 2.1. Test Template

-   **File:** `verif/csme_usbr/tests/templates/usbr_base_test.svh.template`
-   **Purpose:** This is the template for a UVM test. It defines the base test class, `usbr_base_test`, from which all other tests are derived.
-   **Key Sections for AI:**
    -   `build_phase`: The agent can insert code here to set or override the environment configuration (`m_cfg`).
    -   `run_phase`: The agent's primary insertion point. It should generate the code to create and start its top-level sequence on the virtual sequencer.

### 2.2. Configuration Template

-   **File:** `verif/csme_usbr/env/templates/moa_usbr_cfg.sv.template`
-   **Purpose:** Defines the main configuration object for the environment.
-   **Key Sections for AI:**
    -   **Parameter Declarations:** The agent can add new configuration knobs here (e.g., `rand int num_transactions;`). This would allow generated sequences to be controlled from the test level.
    -   **Constraints:** The agent can add new constraints to control the randomization of the configuration object.

### 2.3. Sequence Template (Inferred)

While there isn't an explicit `_seq.sv.template`, the files in `verif/csme_usbr/env/seqlib/` follow a clear pattern that can be treated as an implicit template.

-   **Base Class:** `moa_usbr_base_seq`
-   **Structure:**
    -   Factory registration (`uvm_object_utils`).
    -   Handles for other sequences to be executed.
    -   A `body()` task that contains the main stimulus logic.
-   **AI Generation Goal:** The agent should generate the content of the `body()` task. This will involve creating, randomizing, and starting other lower-level sequences from the `seqlib`.

## 3. Proposed Code Generation Templates for the AI Agent

The following are concrete templates the AI agent should use to generate code that fits the `ip-csme` architecture.

### Template 1: New Test File

**File Location:** `verif/csme_usbr/tests/moa_usbr_ai_<feature>_test.sv`

```systemverilog
// This file is auto-generated by the AI Test Generation Agent.
class moa_usbr_ai_{{feature}}_test extends usbr_base_test;
  `uvm_component_utils(moa_usbr_ai_{{feature}}_test)

  function new(string name, uvm_component parent);
    super.new(name, parent);
  endfunction

  virtual task run_phase(uvm_phase phase);
    csme_usbr_ai_{{feature}}_seq m_seq;
    phase.raise_objection(this);
    m_seq = csme_usbr_ai_{{feature}}_seq::type_id::create("m_seq");
    m_seq.start(m_env.m_vsequencer);
    phase.drop_objection(this);
  endtask
endclass
```

-   `{{feature}}`: A placeholder for the specific feature being tested (e.g., `coverage_hole_fill`, `dma_error_injection`).

### Template 2: New Top-Level Sequence

**File Location:** `verif/csme_usbr/env/seqlib/csme_usbr_ai_<feature>_seq.sv`

```systemverilog
// This file is auto-generated by the AI Test Generation Agent.
class csme_usbr_ai_{{feature}}_seq extends moa_usbr_base_seq;
  `uvm_object_utils(csme_usbr_ai_{{feature}}_seq)

  // --- Agent-Generated Sequence Handles ---
  {{sequence_handles}}

  function new(string name = "csme_usbr_ai_{{feature}}_seq");
    super.new(name);
  endfunction

  virtual task body();
    // --- Agent-Generated Stimulus Logic ---
    {{stimulus_logic}}
    // --- End of Agent-Generated Logic ---
  endtask
endclass
```

-   `{{sequence_handles}}`: The agent will insert declarations for any other sequences it needs to run (e.g., `csme_usbr_init_seq m_init_seq;`).
-   `{{stimulus_logic}}`: The agent will insert the core logic of the sequence here. This would involve creating, randomizing, and starting the sequences declared above.

### Template 3: Adding a New Configuration Parameter

**File to Modify:** `verif/csme_usbr/env/templates/moa_usbr_cfg.sv.template`

```systemverilog
class moa_usbr_cfg extends uvm_object;
  // ... existing parameters ...

  // --- Added by AI Agent ---
  rand int ai_num_bulk_trans = 10;
  constraint ai_num_bulk_trans_c {
    ai_num_bulk_trans inside {[1:100]};
  }
  // --- End of AI Agent Section ---

  // ... existing code ...
endclass
```

By using these templates, the AI agent can focus on its core task—generating meaningful stimulus logic—while ensuring the output is always syntactically correct and architecturally consistent with the `ip-csme` environment.
